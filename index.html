<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dan's Book Tracker 2026</title>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.tailwindcss.com"></script>

<!-- Medieval Font -->
<link href="https://fonts.googleapis.com/css2?family=Metamorphous&display=swap" rel="stylesheet">

<style>
:root {
  /* ===== BACKGROUND ===== */
  --bg-page: linear-gradient(to bottom, #FDF6E3, #FBE9B7); /* parchment gradient from top to bottom */
  --bg-card: linear-gradient(to bottom, #F9EBC6, #F5DFA3); /* slightly darker parchment for cards */
  --bg-soft: #FFF8E0; /* light panel interiors, soft cream */

  /* ===== TEXT ===== */
  --text-main: #2B1B0E;     /* dark ink brown for main text */
  --text-muted: #6B5842;    /* muted brown for secondary text */

  /* ===== ACCENTS ===== */
  --accent-primary: #8B0000;  /* deep red, like illuminated initials */
  --accent-secondary: #005F73; /* dark teal ink for highlights */
  --accent-progress: #D4AF37;  /* gold for progress bar and emphasis */

  /* ===== CHART COLORS ===== */
  --chart-1: #8B0000;  /* deep red */
  --chart-2: #005F73;  /* dark teal */
  --chart-3: #D4AF37;  /* gold */
  --chart-4: #A0522D;  /* sienna brown */
  --chart-5: #6B5842;  /* muted brown */
  --chart-6: #B22222;  /* firebrick red */
  --chart-7: #4B0082;  /* indigo */
  --chart-8: #CD853F;  /* peru brown */
  --chart-9: #556B2F;  /* olive green */
  --chart-10: #F5DEB3; /* wheat */
}
body { 
  font-family: Arial, sans-serif; 
  background-color: var(--bg-page);
	color: var(--text-main);
}

h1, .book-title, .chart-title {
  font-family: 'Metamorphous', serif;
}

.star { color: gold; font-size: 1.2em; }

.progress-marker { 
  position: absolute; 
  width: 2px; 
  background: white; 
  top: 0; 
  bottom: 0; 
}

.progress-container { position: relative; height: 1.5rem; }

.progress-text { 
  position: absolute; 
  width: 100%; 
  text-align: center; 
  font-weight: bold; 
  top:0; 
  line-height:1.5rem; 
}

.chart-container { width: 10rem; height: 10rem; position: relative; }

.chart-title { text-align:center; font-weight:bold; margin-bottom:0.25rem; }

.book-item { 
  background: var(--bg-card);
  padding:1rem; 
  border-radius:0.5rem; 
  transition: transform 0.2s, box-shadow 0.2s; 
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}

.book-item:hover { 
  transform: translateY(-4px); 
  box-shadow: 0 4px 12px rgba(0,0,0,0.15); 
}

.book-title { 
  font-weight: 700; 
  font-size: 1.25rem; 
  margin-bottom: 0.75rem; 
  text-align: left; 
}

.book-content { display:flex; gap:1rem; align-items:flex-start; }

.book-cover { 
  width: 120px; 
  height: 180px; 
  object-fit: cover; 
  border-radius:0.25rem; 
}

.book-info { 
  display: flex; 
  flex-direction: column; 
  justify-content: flex-start; 
  background: rgba(255, 248, 231, 0); 
  padding: 0.5rem; 
  border-radius: 0.25rem; 
  box-shadow: 0 1px 3px rgba(0,0,0,0.05); 
}

.description-box { 
  background: var(--bg-card); 
  padding:1rem; 
  border-radius:0.5rem; 
  box-shadow: 0 1px 4px rgba(0,0,0,0.05); 
  margin-bottom:1rem; 
}
</style>
</head>
<body class="p-6">

<h1 class="text-3xl font-bold mb-6 text-center">ðŸ“š Dan's Book Tracker 2026</h1>

<div class="grid md:grid-cols-2 gap-6 mb-6">

  <!-- Currently Reading -->
  <div id="currentlyReading" class="p-4 rounded-lg shadow-lg overflow-auto max-h-[400px]" style="background: var(--bg-card);"></div>

  <!-- Right Side: Description + Stats -->
  <div class="space-y-4">
    <div class="description-box">
      <p>In 2026 I decided I would read at least 100 books. I decided to track them in a spreadsheet and then eventually I made this to show my progress and relevant stats in a nicer form.</p>
    </div>
    <div id="stats" class="p-4 rounded-lg shadow-lg text-center" style="background: var(--bg-card);"></div>
  </div>

  <!-- Pie Charts -->
  <div class="p-4 rounded-lg shadow-lg flex justify-around flex-wrap" style="background: var(--bg-card);">
    <div class="text-center">
      <div class="chart-title">Genre</div>
      <div class="chart-container"><canvas id="genreChart"></canvas></div>
    </div>
    <div class="text-center">
      <div class="chart-title">Language</div>
      <div class="chart-container"><canvas id="languageChart"></canvas></div>
    </div>
    <div class="text-center">
      <div class="chart-title">Country</div>
      <div class="chart-container"><canvas id="countryChart"></canvas></div>
    </div>
  </div>

  <!-- Bars: Progress first, then Fiction vs Non-Fiction, then Author Gender -->
  <div class="space-y-4">
    <div id="readProgressBar" class="p-4 rounded-lg shadow-lg relative" style="background: var(--bg-card);"></div>
    <div id="fictionBar" class="p-4 rounded-lg shadow-lg relative" style="background: var(--bg-card);"></div>
    <div id="genderBarContainer" class="p-4 rounded-lg shadow-lg relative" style="background: var(--bg-card);"></div>
  </div>

</div>

<!-- Book list -->
<div id="bookList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-4"></div>

<!-- LinkedIn link -->
<div class="mt-6 text-center">
  <a href="https://www.linkedin.com/in/daniel-moore-485b92120/" target="_blank" class="text-blue-600 underline">Connect with me on LinkedIn</a>
</div>

<!-- Debug -->
<div id="debug" class="mt-12 p-4 bg-gray-100 rounded shadow text-sm overflow-x-auto"></div>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSDLnokY9AAjmaXbQ4Ofk-jH6eK1mn9bXcgAid1xWU_2MbtoraDDL5IzoEYT7PPT-numSfmt0EJoS6a/pub?gid=1531654911&single=true&output=csv";
let genreChartInstance=null, languageChartInstance=null, countryChartInstance=null;

async function fetchBooks(){
    const debugDiv = document.getElementById("debug");
    try {
        const res = await fetch(CSV_URL);
        const text = await res.text();
        debugDiv.innerHTML = `<p>CSV fetch status: ${res.status}</p>`;
        const { data } = Papa.parse(text,{header:false,skipEmptyLines:true});
        // keep order as in sheet
        const books = data.slice(5).map((row,index)=>({
            Book: row[0]||"",
            Author: row[1]||"",
            Fiction: row[2]||"",
            Read: row[3]||"",
            "Date Finished": row[4]||"",
            Rating: row[5]||"",
            Gender: row[7]||"",
            Language: row[8]||"",
            Genre: row[9]?.trim() || "Other",
            Country: row[11]||"",
            Cover: row[10]||"",
            _rowIndex:index+6
        }));
        debugDiv.innerHTML += `<p>Total books parsed: ${books.length}</p>`;
        return books;
    } catch(err){
        debugDiv.innerHTML += `<p style="color:red;">Failed to fetch CSV: ${err}</p>`;
        return [];
    }
}

function renderStars(rating){
    if(!rating) return "-";
    let r = parseFloat(rating);
    const fullStars = Math.floor(r);
    const halfStar = (r - fullStars) >= 0.5 ? 1 : 0;
    const emptyStars = 5 - fullStars - halfStar;
    return 'â˜…'.repeat(fullStars) + (halfStar?'â¯¨':'') + 'â˜†'.repeat(emptyStars);
}

function renderCurrentlyReading(books){
    const div = document.getElementById("currentlyReading");
    div.innerHTML = `<p class="text-lg font-semibold mb-2">ðŸ“– Currently Reading</p>`; 
    const current = books.filter(b=>!b.Read || b.Read.toLowerCase()!=="finished");
    if(current.length===0){ div.innerHTML += "<p>No books currently reading</p>"; return; }
    current.forEach(b=>{
        const coverHTML = b.Cover ? `<img class="book-cover" src="${b.Cover}" alt="cover">` : "";
        const infoHTML = `<div class="book-info">
                            <p><strong>Author:</strong> ${b.Author}</p>
                            <p><strong>Genre:</strong> ${b.Genre || b.Fiction}</p>
                            <p><strong>Fiction/Non-Fiction:</strong> ${b.Fiction}</p>
                            <p><strong>Language:</strong> ${b.Language}</p>
                            <p><strong>Date Finished:</strong> ${b["Date Finished"]}</p>
                          </div>`;
        div.innerHTML += `<div class="book-item">
                            <p class="book-title">${b.Book}</p>
                            <div class="book-content">
                              ${coverHTML}${infoHTML}
                            </div>
                          </div>`;
    });
}

function renderBooks(books){
    const bookList = document.getElementById("bookList");
    bookList.innerHTML = "";
    // flip order: last row in CSV first
    const sorted = books.filter(b => b.Read && b.Read.toLowerCase() === "finished").reverse();

    sorted.forEach(b => {
        const stars = renderStars(b.Rating);

        // Decide color for the bar based on Fiction/Non-Fiction
        let barColor = getComputedStyle(document.documentElement).getPropertyValue('--accent-primary');
		if(b.Fiction.toLowerCase().includes("non-fiction")) {
			barColor = getComputedStyle(document.documentElement).getPropertyValue('--accent-secondary');
		}

        const coverHTML = b.Cover ? `<img class="book-cover" src="${b.Cover}" alt="cover">` : "";

        const infoHTML = `
            <div class="book-info">
                <div style="height:4px; width:100%; background:${barColor}; border-radius:2px; margin-bottom:0.5rem;"></div>
                <p><strong>Author:</strong> ${b.Author}</p>
                <p><strong>Genre:</strong> ${b.Genre || b.Fiction}</p>
                <p><strong>Fiction/Non-Fiction:</strong> ${b.Fiction}</p>
                <p><strong>Language:</strong> ${b.Language}</p>
                <p><strong>Date Finished:</strong> ${b["Date Finished"]}</p>
                <p><strong>Rating:</strong> <span class="star">${stars}</span></p>
            </div>
        `;

        bookList.innerHTML += `
            <div class="book-item">
                <p class="book-title">${b.Book}</p>
                <div class="book-content">
                    ${coverHTML}
                    ${infoHTML}
                </div>
            </div>
        `;
    });
}

function renderStatsAndBars(books){
    const finishedBooks = books.filter(b=>b.Read && b.Read.toLowerCase()==="finished").length;
    const remaining = Math.max(100-finishedBooks,0);
    const avgRating = books.filter(b=>b.Rating).length ? (books.filter(b=>b.Rating).reduce((s,b)=>s+Number(b.Rating),0)/books.filter(b=>b.Rating).length).toFixed(2) : "-";

    document.getElementById("stats").innerHTML=`
        <p class="text-lg"><strong>Finished:</strong> ${finishedBooks}</p>
        <p class="text-lg"><strong>Remaining to 100:</strong> ${remaining}</p>
        <p class="text-lg"><strong>Average Rating:</strong> ${avgRating}</p>
    `;

    const today=new Date(), start=new Date(today.getFullYear(),0,1), end=new Date(today.getFullYear(),11,31);
    const yearFraction = (today-start)/(end-start);
    const expectedBooks = Math.floor(100*yearFraction);
    const percent = Math.min((finishedBooks/100)*100,100);
    const markerPercent = Math.min((expectedBooks/100)*100,100);

    document.getElementById("readProgressBar").innerHTML=`
        <p class="text-lg font-semibold mb-2">Reading Progress</p>
        <div class="w-full bg-gray-300 h-6 relative">
            <div style="background: var(--accent-progress); width:${percent}%; height:100%;"></div>
            <div class="progress-marker" style="left:${markerPercent}%"></div>
            <div class="progress-text">${finishedBooks} / 100 (Expected: ${expectedBooks})</div>
        </div>
    `;
}

// Generic horizontal bar renderer for Fiction/Non-Fiction and Author Gender
function renderHorizontalBar(containerId, title, dataObj, colors){
    const container = document.getElementById(containerId);
    container.innerHTML = `<p class="text-lg font-semibold mb-2">${title}</p>`;

    const total = Object.values(dataObj).reduce((a,b)=>a+b,0);
    if(total === 0){
        container.innerHTML += "<p>No data available</p>";
        return;
    }

    const barWrapper = document.createElement("div");
    barWrapper.className = "w-full bg-gray-300 h-8 rounded overflow-hidden flex relative";

    let i = 0;
    for(const [key,count] of Object.entries(dataObj)){
        const percent = ((count/total)*100).toFixed(1);
        const segment = document.createElement("div");
        segment.className = `${colors[i % colors.length]} h-full flex items-center justify-center text-white text-sm font-semibold`;
        segment.style.width = `${percent}%`;
        segment.innerHTML = `${key} (${count}, ${percent}%)`;
        barWrapper.appendChild(segment);
        i++;
    }
    container.appendChild(barWrapper);
}

function renderPieChart(id, dataObj){
    const labels = Object.keys(dataObj);
    const data = Object.values(dataObj);
    const ctx = document.getElementById(id);

    if(id==="genreChart" && genreChartInstance) genreChartInstance.destroy();
    if(id==="languageChart" && languageChartInstance) languageChartInstance.destroy();
    if(id==="countryChart" && countryChartInstance) countryChartInstance.destroy();

    // Get theme colours from CSS variables
    const rootStyles = getComputedStyle(document.documentElement);
    const themeColors = [
        rootStyles.getPropertyValue('--chart-1').trim(),
        rootStyles.getPropertyValue('--chart-2').trim(),
        rootStyles.getPropertyValue('--chart-3').trim(),
        rootStyles.getPropertyValue('--chart-4').trim(),
        rootStyles.getPropertyValue('--chart-5').trim(),
        rootStyles.getPropertyValue('--chart-6').trim()
    ];

    const chart = new Chart(ctx,{
        type:'pie',
        data:{
            labels: labels,
            datasets:[{
                data: data,
                backgroundColor: themeColors
            }]
        },
        options:{
            responsive:true,
            maintainAspectRatio:false,
            aspectRatio:1,
            plugins:{
                legend:{
                    position:'bottom',
                    labels:{
                        boxWidth:12,
                        padding:8
                    }
                }
            }
        }
    });

    if(id==="genreChart") genreChartInstance=chart;
    if(id==="languageChart") languageChartInstance=chart;
    if(id==="countryChart") countryChartInstance=chart;
}

function renderCharts(books){
    const genreCount={}, genderCount={}, langCount={}, countryCount={};
    books.forEach(b=>{
        const g = b.Genre.trim() || "Other";
        genreCount[g]=(genreCount[g]||0)+1;
        if(b.Gender) genderCount[b.Gender]=(genderCount[b.Gender]||0)+1;
        if(b.Language) langCount[b.Language]=(langCount[b.Language]||0)+1;
        if(b.Country) countryCount[b.Country]=(countryCount[b.Country]||0)+1;
    });
    renderPieChart("genreChart",genreCount);
    renderPieChart("languageChart",langCount);
    renderPieChart("countryChart",countryCount);
    const barColors = ["bg-blue-500","bg-yellow-500","bg-indigo-500","bg-teal-500","bg-orange-400","bg-purple-500","bg-gray-500"];
    renderHorizontalBar("fictionBar","Fiction vs Non-Fiction",{Fiction:books.filter(b=>b.Fiction.toLowerCase().includes("fiction")).length, "Non-Fiction":books.filter(b=>b.Fiction.toLowerCase().includes("non-fiction")).length},barColors);
    renderHorizontalBar("genderBarContainer","Author Gender",genderCount,barColors);
}

async function init(){
    const books = await fetchBooks();
    renderCurrentlyReading(books);
    renderStatsAndBars(books);
    renderBooks(books);
    renderCharts(books);
}

init();
</script>
</body>
</html>